{% extends "base.html" %}

{% block navigation %}
{% include 'components/client_navigation.html' %}
{% endblock %}

{% block title %}Event Feedback - {{ event.event_name }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-4xl">
    <!-- Navigation -->
    <nav class="mb-8">
        <a href="/client/events" class="inline-flex items-center text-blue-600 hover:text-blue-800 transition-colors duration-200">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
            Back to Events
        </a>    </nav>    <!-- Header -->
    <div class="bg-gradient-to-r from-blue-600 to-indigo-700 rounded-xl shadow-2xl text-white p-8 mb-8">
        <h1 class="text-3xl font-bold mb-4">Event Feedback</h1>
        <h2 class="text-xl font-semibold mb-2">{{ event.event_name }}</h2>
        <p class="text-blue-100">Your feedback helps us improve future events. Please take a moment to share your thoughts.</p>
    </div>

    {% if auto_populated %}
    <div class="bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg mb-6" role="alert">
        <div class="flex items-center">
            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
            </svg>
            <p class="font-medium">‚úì Registration and attendance verified successfully - you're eligible for certificate collection!</p>
        </div>
    </div>
    {% endif %}

    {% if error %}
    <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6" role="alert">
        <p class="font-medium">{{ error }}</p>
    </div>
    {% endif %}    <!-- Feedback Form -->
    <form method="POST" class="bg-white rounded-xl shadow-lg p-8" id="feedback-form">
        <!-- Progress Indicator -->
        <div class="mb-8">            <div class="flex items-center justify-between mb-4">
                <div class="text-sm text-gray-500" id="step-counter">
                    Step 1 of 7
                </div>
            </div>
            
            <!-- Progress Bar -->
            <div class="w-full bg-gray-200 rounded-full h-2">
                <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" id="progress-bar" style="width: 14.3%"></div>
            </div>
            
            <!-- Step Navigation Dots -->
            <div class="flex justify-center mt-4 space-x-2">
                <div class="w-3 h-3 rounded-full bg-blue-600 step-dot active" data-step="1"></div>
                <div class="w-3 h-3 rounded-full bg-gray-300 step-dot" data-step="2"></div>
                <div class="w-3 h-3 rounded-full bg-gray-300 step-dot" data-step="3"></div>
                <div class="w-3 h-3 rounded-full bg-gray-300 step-dot" data-step="4"></div>
                {% if event.is_team_based %}
                <div class="w-3 h-3 rounded-full bg-gray-300 step-dot" data-step="5"></div>
                {% endif %}
                {% if event.is_paid %}
                <div class="w-3 h-3 rounded-full bg-gray-300 step-dot" data-step="6"></div>
                {% endif %}
                <div class="w-3 h-3 rounded-full bg-gray-300 step-dot" data-step="7"></div>
            </div>
        </div>        <!-- Step 1: Participant Details -->
        <div class="form-step active" id="step-1" data-step="1">
            <div class="mb-8 p-6 bg-gray-50 rounded-lg">
                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <span class="mr-3 text-2xl">üë§</span>
                    Step 1: Participant Details
                </h3>
                <p class="text-sm text-gray-600 mb-6">Help us identify context - name and email are optional for anonymity.</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Full Name (Optional)</label>
                        <input type="text" name="participant_name" value="{{ registration.full_name }}" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Your name (optional for anonymity)">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email ID (Optional)</label>
                        <input type="email" name="participant_email" value="{{ registration.email }}"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Your email (optional)">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Event Attended</label>
                        <input type="text" value="{{ event.event_name }}" readonly
                            class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 cursor-not-allowed">
                    </div>                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Registration Type</label>
                        <input type="text" value="{% if event.is_team_based %}Team Event{% else %}Individual Event{% endif %}" readonly
                            class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 cursor-not-allowed">
                        <!-- Hidden field to store the actual value for form submission -->
                        <input type="hidden" name="registration_type" value="{% if event.is_team_based %}team{% else %}individual{% endif %}">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Department / Course</label>
                        <input type="text" name="department" value="{{ registration.department }}"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Year of Study</label>
                        <select name="year_of_study" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Select year</option>
                            <option value="1" {% if registration.semester in ['1', '2'] %}selected{% endif %}>1st Year</option>
                            <option value="2" {% if registration.semester in ['3', '4'] %}selected{% endif %}>2nd Year</option>
                            <option value="3" {% if registration.semester in ['5', '6'] %}selected{% endif %}>3rd Year</option>
                            <option value="4" {% if registration.semester in ['7', '8'] %}selected{% endif %}>4th Year</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                
                <div class="flex justify-end mt-8">
                    <button type="button" class="next-btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                        Next Step ‚Üí
                    </button>
                </div>
            </div>
        </div>        <!-- Step 2: General Event Experience -->
        <div class="form-step hidden" id="step-2" data-step="2">
            <div class="mb-8 p-6 bg-blue-50 rounded-lg">
                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <span class="mr-3 text-2xl">‚≠ê</span>
                    Step 2: General Event Experience
                </h3>
                <p class="text-sm text-gray-600 mb-6">Tell us about your overall satisfaction with the event.</p>
                
                <div class="space-y-8">
                    <!-- Overall Satisfaction -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">
                            How satisfied were you with the event? <span class="text-red-500">*</span>
                        </label>
                        <div class="flex gap-3">
                            {% for i in range(1, 6) %}
                            <label class="flex items-center cursor-pointer p-3 rounded-lg border-2 border-gray-300 transition-all duration-200 hover:bg-yellow-50 hover:border-yellow-400">
                                <input type="radio" name="overall_satisfaction" value="{{ i }}" required
                                    class="focus:ring-yellow-500 h-4 w-4 text-yellow-600 border-gray-300">
                                <span class="ml-2 text-lg">{{ "‚≠ê" * i }}</span>
                                <span class="ml-1 text-sm text-gray-600">{{ i }}</span>
                            </label>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Recommendation Likelihood -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">
                            How likely are you to recommend this event to others? <span class="text-red-500">*</span>
                        </label>
                        <div class="space-y-2">
                            {% for option in [('very_likely', 'Very likely üòç'), ('likely', 'Likely üëç'), ('neutral', 'Neutral üòê'), ('unlikely', 'Unlikely üëé'), ('very_unlikely', 'Very unlikely üòû')] %}
                            <label class="flex items-center cursor-pointer p-3 rounded-lg border-2 border-gray-300 transition-all duration-200 hover:bg-green-50 hover:border-green-400">
                                <input type="radio" name="recommendation_likelihood" value="{{ option[0] }}" required
                                    class="focus:ring-green-500 h-4 w-4 text-green-600 border-gray-300">
                                <span class="ml-3 text-sm font-medium">{{ option[1] }}</span>
                            </label>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Favorite Part -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            What was your favorite part of the event? <span class="text-red-500">*</span>
                        </label>                        <textarea name="favorite_part" rows="3" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 resize-none"
                            placeholder="Describe what you enjoyed most..." maxlength="500"></textarea>
                    </div>

                    <!-- Improvements -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            What would you improve for future editions? <span class="text-red-500">*</span>
                        </label>                        <textarea name="future_improvements" rows="3" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 resize-none"
                            placeholder="Share your suggestions for improvement..." maxlength="500"></textarea>
                    </div>
                </div>
                
                <div class="flex justify-between mt-8">
                    <button type="button" class="prev-btn bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition-all duration-200">
                        ‚Üê Previous
                    </button>
                    <button type="button" class="next-btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                        Next Step ‚Üí
                    </button>
                </div>
            </div>
        </div>        <!-- Step 3: Event Logistics & Organization -->
        <div class="form-step hidden" id="step-3" data-step="3">
            <div class="mb-8 p-6 bg-green-50 rounded-lg">
                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <span class="mr-3 text-2xl">üìã</span>
                    Step 3: Event Logistics & Organization
                </h3>
                <p class="text-sm text-gray-600 mb-6">Help us understand how well the event was organized and managed.</p>
                
                <div class="space-y-8">
                    <!-- Well Organized -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">
                            Was the event well-organized? <span class="text-red-500">*</span>
                        </label>
                        <div class="flex gap-3">
                            {% for option in [('yes', 'Yes üëç'), ('no', 'No üëé'), ('somewhat', 'Somewhat ü§î')] %}
                            <label class="flex items-center cursor-pointer p-3 rounded-lg border-2 border-gray-300 transition-all duration-200 hover:bg-green-50 hover:border-green-400">
                                <input type="radio" name="well_organized" value="{{ option[0] }}" required
                                    class="focus:ring-green-500 h-4 w-4 text-green-600 border-gray-300">
                                <span class="ml-3 text-sm font-medium">{{ option[1] }}</span>
                            </label>
                            {% endfor %}
                        </div>
                    </div>                    <!-- Communication -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">
                            Was communication (pre-event/post-event) clear and timely? <span class="text-red-500">*</span>
                        </label>
                        <div class="flex flex-wrap gap-3">
                            {% for i in range(1, 6) %}
                            <label class="flex items-center cursor-pointer p-3 rounded-lg border-2 border-gray-300 transition-all duration-200 hover:bg-blue-50 hover:border-blue-400">
                                <input type="radio" name="communication_quality" value="{{ i }}" required
                                    class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300">
                                <span class="ml-2 text-sm font-medium text-blue-600">{{ i }} - {{ ['Poor', 'Below Avg', 'Average', 'Good', 'Excellent'][i-1] }}</span>
                            </label>
                            {% endfor %}
                        </div>
                    </div>                    <!-- Schedule -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">
                            Was the schedule followed properly? <span class="text-red-500">*</span>
                        </label>
                        <div class="flex flex-wrap gap-3">
                            {% for i in range(1, 6) %}
                            <label class="flex items-center cursor-pointer p-3 rounded-lg border-2 border-gray-300 transition-all duration-200 hover:bg-purple-50 hover:border-purple-400">
                                <input type="radio" name="schedule_adherence" value="{{ i }}" required
                                    class="focus:ring-purple-500 h-4 w-4 text-purple-600 border-gray-300">
                                <span class="ml-2 text-sm font-medium text-purple-600">{{ i }} - {{ ['Poor', 'Below Avg', 'Average', 'Good', 'Excellent'][i-1] }}</span>
                            </label>
                            {% endfor %}
                        </div>
                    </div>                    <!-- Venue/Platform -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">
                            Was the venue or online platform suitable? <span class="text-red-500">*</span>
                        </label>
                        <div class="flex flex-wrap gap-3">
                            {% for i in range(1, 6) %}
                            <label class="flex items-center cursor-pointer p-3 rounded-lg border-2 border-gray-300 transition-all duration-200 hover:bg-orange-50 hover:border-orange-400">
                                <input type="radio" name="venue_suitability" value="{{ i }}" required
                                    class="focus:ring-orange-500 h-4 w-4 text-orange-600 border-gray-300">
                                <span class="ml-2 text-sm font-medium text-orange-600">{{ i }} - {{ ['Poor', 'Below Avg', 'Average', 'Good', 'Excellent'][i-1] }}</span>
                            </label>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-between mt-8">
                    <button type="button" class="prev-btn bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition-all duration-200">
                        ‚Üê Previous
                    </button>
                    <button type="button" class="next-btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                        Next Step ‚Üí
                    </button>
                </div>
            </div>
        </div>        <!-- Step 4: Content & Delivery -->
        <div class="form-step hidden" id="step-4" data-step="4">
            <div class="mb-8 p-6 bg-yellow-50 rounded-lg">
                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <span class="mr-3 text-2xl">üéØ</span>
                    Step 4: Content & Delivery
                </h3>
                <p class="text-sm text-gray-600 mb-6">Rate the educational value and delivery quality of the event.</p>
                
                <div class="space-y-8">                    <!-- Content Relevance -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">
                            Was the content relevant and useful? <span class="text-red-500">*</span>
                        </label>
                        <div class="flex flex-wrap gap-3">
                            {% for i in range(1, 6) %}
                            <label class="flex items-center cursor-pointer p-3 rounded-lg border-2 border-gray-300 transition-all duration-200 hover:bg-indigo-50 hover:border-indigo-400">
                                <input type="radio" name="content_relevance" value="{{ i }}" required
                                    class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300">
                                <span class="ml-2 text-sm font-medium text-indigo-600">{{ i }} - {{ ['Not relevant', 'Slightly', 'Moderately', 'Very', 'Extremely'][i-1] }}</span>
                            </label>
                            {% endfor %}
                        </div>
                    </div>                    <!-- Speaker/Facilitator -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">
                            Was the speaker/facilitator/judge engaging? <span class="text-red-500">*</span>
                        </label>
                        <div class="flex flex-wrap gap-3">
                            {% for i in range(1, 6) %}
                            <label class="flex items-center cursor-pointer p-3 rounded-lg border-2 border-gray-300 transition-all duration-200 hover:bg-pink-50 hover:border-pink-400">
                                <input type="radio" name="speaker_engagement" value="{{ i }}" required
                                    class="focus:ring-pink-500 h-4 w-4 text-pink-600 border-gray-300">
                                <span class="ml-2 text-sm font-medium text-pink-600">{{ i }} - {{ ['Not engaging', 'Slightly', 'Moderately', 'Very', 'Extremely'][i-1] }}</span>
                            </label>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Met Expectations -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">
                            Did the event meet your expectations? <span class="text-red-500">*</span>
                        </label>
                        <div class="flex gap-3">
                            {% for option in [('yes', 'Yes ‚úÖ'), ('no', 'No ‚ùå'), ('exceeded', 'Exceeded expectations üöÄ')] %}
                            <label class="flex items-center cursor-pointer p-3 rounded-lg border-2 border-gray-300 transition-all duration-200 hover:bg-teal-50 hover:border-teal-400">
                                <input type="radio" name="met_expectations" value="{{ option[0] }}" required
                                    class="focus:ring-teal-500 h-4 w-4 text-teal-600 border-gray-300">
                                <span class="ml-3 text-sm font-medium">{{ option[1] }}</span>
                            </label>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Outstanding Sessions -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Any sessions/segments that stood out (positively or negatively)?
                        </label>                        <textarea name="outstanding_sessions" rows="3"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 resize-none"
                            placeholder="Mention specific sessions or segments..." maxlength="500"></textarea>
                    </div>
                </div>
                
                <div class="flex justify-between mt-8">
                    <button type="button" class="prev-btn bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition-all duration-200">
                        ‚Üê Previous
                    </button>
                    <button type="button" class="next-btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                        Next Step ‚Üí
                    </button>
                </div>
            </div>
        </div>        <!-- Step 5: Team Events Only (Conditional) -->
        {% if event.is_team_based %}
        <div class="form-step hidden" id="step-5" data-step="5">
            <div class="mb-8 p-6 bg-purple-50 rounded-lg">
                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <span class="mr-3 text-2xl">üë•</span>
                    Step 5: Team Events Only
                </h3>
                <p class="text-sm text-gray-600 mb-6">Tell us about the team-based aspects of this event.</p>
                
                <div class="space-y-8">
                    <!-- Team Size -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Team Size</label>
                        <input type="number" name="team_size" min="1" max="20"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Number of team members">
                    </div>

                    <!-- Team Format Management -->
                    <div>                        <label class="block text-sm font-medium text-gray-700 mb-3">
                            Was the team-based format well-managed?
                        </label>
                        <div class="flex flex-wrap gap-3">
                            {% for i in range(1, 6) %}
                            <label class="flex items-center cursor-pointer p-3 rounded-lg border-2 border-gray-300 transition-all duration-200 hover:bg-purple-50 hover:border-purple-400">
                                <input type="radio" name="team_format_management" value="{{ i }}"
                                    class="focus:ring-purple-500 h-4 w-4 text-purple-600 border-gray-300">
                                <span class="ml-2 text-sm font-medium text-purple-600">{{ i }} - {{ ['Poor', 'Below Avg', 'Average', 'Good', 'Excellent'][i-1] }}</span>
                            </label>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Rules and Judging -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">
                            Were rules and judging criteria clearly explained?
                        </label>
                        <div class="flex gap-3">
                            {% for option in [('yes', 'Yes üëç'), ('no', 'No üëé'), ('somewhat', 'Somewhat ü§î')] %}
                            <label class="flex items-center cursor-pointer p-3 rounded-lg border-2 border-gray-300 transition-all duration-200 hover:bg-purple-50 hover:border-purple-400">
                                <input type="radio" name="rules_clarity" value="{{ option[0] }}"
                                    class="focus:ring-purple-500 h-4 w-4 text-purple-600 border-gray-300">
                                <span class="ml-3 text-sm font-medium">{{ option[1] }}</span>
                            </label>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-between mt-8">
                    <button type="button" class="prev-btn bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition-all duration-200">
                        ‚Üê Previous
                    </button>
                    <button type="button" class="next-btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                        Next Step ‚Üí
                    </button>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Step 6: Paid Events Only (Conditional) -->
        {% if event.is_paid %}
        <div class="form-step hidden" id="step-6" data-step="6">
            <div class="mb-8 p-6 bg-orange-50 rounded-lg">
                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <span class="mr-3 text-2xl">üí∞</span>
                    Step 6: Paid Events Only
                </h3>
                <p class="text-sm text-gray-600 mb-6">Help us understand the value and payment experience.</p>
                
                <div class="space-y-8">
                    <!-- Value for Money -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">
                            Did the value of the event justify the cost?
                        </label>
                        <div class="flex gap-3">
                            {% for option in [('yes', 'Yes üíé'), ('no', 'No üí∏')] %}
                            <label class="flex items-center cursor-pointer p-3 rounded-lg border-2 border-gray-300 transition-all duration-200 hover:bg-orange-50 hover:border-orange-400">
                                <input type="radio" name="value_for_money" value="{{ option[0] }}"
                                    class="focus:ring-orange-500 h-4 w-4 text-orange-600 border-gray-300">
                                <span class="ml-3 text-sm font-medium">{{ option[1] }}</span>
                            </label>
                            {% endfor %}
                        </div>
                    </div>                    <!-- Payment Process -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">
                            Was the payment process smooth?
                        </label>
                        <div class="flex flex-wrap gap-3">
                            {% for i in range(1, 6) %}
                            <label class="flex items-center cursor-pointer p-3 rounded-lg border-2 border-gray-300 transition-all duration-200 hover:bg-orange-50 hover:border-orange-400">
                                <input type="radio" name="payment_process" value="{{ i }}"
                                    class="focus:ring-orange-500 h-4 w-4 text-orange-600 border-gray-300">
                                <span class="ml-2 text-sm font-medium text-orange-600">{{ i }} - {{ ['Very difficult', 'Difficult', 'Average', 'Smooth', 'Very smooth'][i-1] }}</span>
                            </label>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Payment Issues -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Any issues with receipt/payment confirmation?
                        </label>                        <textarea name="payment_issues" rows="2"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 resize-none"
                            placeholder="Describe any payment-related issues..." maxlength="300"></textarea>
                    </div>
                </div>
                
                <div class="flex justify-between mt-8">
                    <button type="button" class="prev-btn bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition-all duration-200">
                        ‚Üê Previous
                    </button>
                    <button type="button" class="next-btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                        Next Step ‚Üí
                    </button>
                </div>
            </div>
        </div>
        {% endif %}        <!-- Step 7: Suggestions & Final Comments -->
        <div class="form-step hidden" id="step-7" data-step="7">
            <div class="mb-8 p-6 bg-indigo-50 rounded-lg">
                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <span class="mr-3 text-2xl">üí≠</span>
                    Step 7: Suggestions & Final Comments
                </h3>
                <p class="text-sm text-gray-600 mb-6">Share your final thoughts and suggestions for future events.</p>
                
                <div class="space-y-8">
                    <!-- What could we do better -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            What could we do better next time? <span class="text-red-500">*</span>
                        </label>                        <textarea name="future_suggestions" rows="3" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 resize-none"
                            placeholder="Share your suggestions for future events..." maxlength="500"></textarea>
                    </div>

                    <!-- Other events -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Any other events you'd like us to organize?
                        </label>                        <textarea name="event_requests" rows="2"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 resize-none"
                            placeholder="Suggest topics, formats, or types of events..." maxlength="400"></textarea>
                    </div>

                    <!-- Additional Comments -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Additional Comments (optional)
                        </label>                        <textarea name="additional_comments" rows="3"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 resize-none"
                            placeholder="Share any additional thoughts or feedback..." maxlength="500"></textarea>
                    </div>
                </div>
                
                <div class="flex justify-between mt-8">
                    <button type="button" class="prev-btn bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition-all duration-200">
                        ‚Üê Previous
                    </button>
                    <button type="submit" class="bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold py-3 px-8 rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                        Submit Feedback & Get Certificate üéØ
                    </button>
                </div>
            </div>
        </div>

        <!-- Submit Button -->
        <div class="flex justify-end hidden" id="submit-section">
            <button type="submit"
                class="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-bold py-3 px-8 rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                Submit Feedback & Get Certificate üéØ
            </button>
        </div>
    </form>
</div>

<script>
// Step Navigation Variables with Sequential Display Mapping
let currentActualStep = 1;

// Get list of visible steps based on event type
function getVisibleSteps() {
    const steps = [1, 2, 3, 4]; // Always visible steps
    if (document.getElementById('step-5')) steps.push(5); // Team step
    if (document.getElementById('step-6')) steps.push(6); // Paid step
    steps.push(7); // Final step always last
    return steps;
}

// Create mapping between actual steps and display step numbers
function createStepMapping() {
    const visibleSteps = getVisibleSteps();
    const actualToDisplay = {};
    const displayToActual = {};
    
    visibleSteps.forEach((actualStep, index) => {
        const displayStep = index + 1;
        actualToDisplay[actualStep] = displayStep;
        displayToActual[displayStep] = actualStep;
    });
    
    return { actualToDisplay, displayToActual, totalSteps: visibleSteps.length };
}

// Get the mapping
const stepMapping = createStepMapping();

// Get display step number for current actual step
function getCurrentDisplayStep() {
    return stepMapping.actualToDisplay[currentActualStep] || 1;
}

// Calculate step mapping for conditional steps
function getNextStepNumber(currentActualStepNum) {
    const visibleSteps = getVisibleSteps();
    const currentIndex = visibleSteps.indexOf(currentActualStepNum);
    
    if (currentIndex !== -1 && currentIndex < visibleSteps.length - 1) {
        return visibleSteps[currentIndex + 1];
    }
    
    return currentActualStepNum; // Can't go further
}

function getPrevStepNumber(currentActualStepNum) {
    const visibleSteps = getVisibleSteps();
    const currentIndex = visibleSteps.indexOf(currentActualStepNum);
    
    if (currentIndex > 0) {
        return visibleSteps[currentIndex - 1];
    }
    
    return currentActualStepNum; // Can't go back
}

// Initialize form
document.addEventListener('DOMContentLoaded', function() {
    // Recalculate step mapping based on actual visible steps in the DOM
    const stepMapping = createStepMapping();
    
    // Update UI based on initial step
    updateStepCounter();
    updateProgressBar();
    updateStepDots();
    
    // Set initial radio button selections for auto-populated data
    document.querySelectorAll('input[type="radio"]:checked').forEach(radio => {
        radio.closest('label').classList.add('bg-blue-50', 'border-blue-200');
    });
});

function updateStepCounter() {
    const counter = document.getElementById('step-counter');
    if (counter) {
        const displayStep = getCurrentDisplayStep();
        counter.textContent = `Step ${displayStep} of ${stepMapping.totalSteps}`;
        
        // Update step title
        const currentStepElement = document.getElementById(`step-${currentActualStep}`);
        if (currentStepElement) {
            const titleElement = currentStepElement.querySelector('h3');
            if (titleElement) {
                // Extract the title text after "Step X: " and update with the new display step number
                const titleText = titleElement.textContent.trim();
                const colonIndex = titleText.indexOf(':');
                if (colonIndex !== -1) {
                    const titleWithoutStepNumber = titleText.substring(colonIndex + 1).trim();
                    titleElement.textContent = `Step ${displayStep}: ${titleWithoutStepNumber}`;
                }
            }
        }
    }
}

function updateProgressBar() {
    const progressBar = document.getElementById('progress-bar');
    if (progressBar) {
        const displayStep = getCurrentDisplayStep();
        const percentage = Math.min((displayStep / stepMapping.totalSteps) * 100, 100);
        progressBar.style.width = percentage + '%';
    }
}

// Step Navigation Functions
function showStep(stepNumber) {
    // Hide all steps
    document.querySelectorAll('.form-step').forEach(step => {
        step.classList.add('hidden');
        step.classList.remove('active');
    });
    
    // Show target step
    const targetStep = document.getElementById(`step-${stepNumber}`);
    if (targetStep) {
        targetStep.classList.remove('hidden');
        targetStep.classList.add('active');
        currentActualStep = stepNumber;
        
        // Update UI elements
        updateStepCounter();
        updateProgressBar();
        updateStepDots();
        
        // Scroll to top of form
        targetStep.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
}

function updateStepDots() {
    const visibleSteps = getVisibleSteps();
    const currentDisplayStep = getCurrentDisplayStep();
    
    // First, hide all dots
    document.querySelectorAll('.step-dot').forEach(dot => {
        dot.style.display = 'none';
    });
    
    // Then show only the dots we need, with proper sequential numbering
    visibleSteps.forEach((actualStepNum, index) => {
        const dot = document.querySelector(`.step-dot[data-step="${actualStepNum}"]`);
        if (dot) {
            dot.style.display = 'block';
            
            // Mark as active if at or before current display step
            const displayStep = index + 1;
            if (displayStep <= currentDisplayStep) {
                dot.classList.add('bg-blue-600');
                dot.classList.remove('bg-gray-300');
            } else {
                dot.classList.add('bg-gray-300');
                dot.classList.remove('bg-blue-600');
            }
            
            // Update the data-step attribute to match the display step
            dot.setAttribute('data-display-step', displayStep);
        }
    });
}

// updateStepCounter function moved to earlier in script

function validateCurrentStep() {
    // Remove existing step errors
    document.querySelectorAll('.step-error').forEach(el => el.remove());
    
    const currentStepElement = document.getElementById(`step-${currentActualStep}`);
    const requiredFields = currentStepElement.querySelectorAll('input[required], textarea[required], select[required]');
    const errors = [];
    const processedRadioGroups = new Set();
    
    requiredFields.forEach(field => {
        if (field.type === 'radio') {
            // Avoid duplicate checks for the same radio group
            if (!processedRadioGroups.has(field.name)) {
                processedRadioGroups.add(field.name);
                const radioGroup = currentStepElement.querySelectorAll(`input[name="${field.name}"]`);
                const checked = Array.from(radioGroup).some(radio => radio.checked);
                if (!checked) {
                    const fieldLabel = field.name.replace(/_/g, ' ').toLowerCase();
                    errors.push(`Please share your thoughts on ${fieldLabel}`);
                }
            }
        } else if (!field.value.trim()) {
            const label = field.closest('div').querySelector('label');
            const fieldName = label ? label.textContent.replace(' *', '').replace('*', '').trim() : field.name.replace(/_/g, ' ');
            errors.push(`We'd love to hear about: ${fieldName}`);
        }
    });
    
    if (errors.length > 0) {
        showValidationError(errors);
        return false;
    }
    
    return true;
}

function showValidationError(errors) {
    // Remove existing error messages
    document.querySelectorAll('.step-error').forEach(el => el.remove());
    
    const errorDiv = document.createElement('div');
    errorDiv.className = 'step-error bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4';
    errorDiv.innerHTML = `
        <div class="flex items-start">
            <svg class="h-5 w-5 text-red-400 mt-0.5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
            </svg>
            <div>
                <h4 class="font-medium mb-1">Help us improve - just a few more details:</h4>
                <ul class="list-disc list-inside text-sm">
                    ${errors.map(error => `<li>${error}</li>`).join('')}
                </ul>
            </div>
        </div>
    `;
    
    const currentStepElement = document.getElementById(`step-${currentActualStep}`);
    currentStepElement.insertBefore(errorDiv, currentStepElement.firstChild);
    
    // Auto-remove after 5 seconds
    setTimeout(() => errorDiv.remove(), 5000);
}

// Next/Previous Button Event Listeners
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('next-btn')) {
        e.preventDefault();
        
        if (validateCurrentStep()) {
            const nextStep = getNextStepNumber(currentActualStep);
            if (nextStep > currentActualStep) {
                showStep(nextStep);
            }
        }
    }
    
    if (e.target.classList.contains('prev-btn')) {
        e.preventDefault();
        
        const prevStep = getPrevStepNumber(currentActualStep);
        if (prevStep < currentActualStep) {
            showStep(prevStep);
        }
    }
});

// Form Submission Handler
document.querySelector('form').addEventListener('submit', function(e) {
    // Remove any existing error messages first
    document.querySelectorAll('.step-error, .form-error').forEach(el => el.remove());
    
    // Step-wise validation for comprehensive feedback form
    const requiredFields = [
        // Step 1 - Participant Details (registration_type is auto-set, others optional)
        
        // Step 2 - General Event Experience
        'overall_satisfaction',
        'recommendation_likelihood', 
        'favorite_part',
        'future_improvements',
        
        // Step 3 - Event Logistics & Organization
        'well_organized',
        'communication_quality',
        'schedule_adherence',
        'venue_suitability',
        
        // Step 4 - Content & Delivery
        'content_relevance',
        'speaker_engagement',
        'met_expectations',
        
        // Step 7 - Suggestions & Final Comments
        'future_suggestions'
    ];

    // Conditional validations based on event type
    {% if event.is_team_based %}
    // Team event specific validations
    const teamFields = ['team_format_management', 'rules_clarity'];
    requiredFields.push(...teamFields);
    {% endif %}

    {% if event.is_paid %}
    // Paid event specific validations  
    const paidFields = ['value_for_money', 'payment_process'];
    requiredFields.push(...paidFields);
    {% endif %}    let errors = [];
    const processedFields = new Set();
    
    // Check each required field
    requiredFields.forEach(field => {
        // Skip if we've already processed this field
        if (processedFields.has(field)) {
            return;
        }
        processedFields.add(field);
        
        const isTextArea = ['favorite_part', 'future_improvements', 'outstanding_sessions', 'future_suggestions', 'event_requests', 'additional_comments', 'payment_issues'].includes(field);
        const isInput = ['participant_name', 'participant_email', 'department', 'year_of_study', 'team_size'].includes(field);
        const isHiddenInput = ['registration_type'].includes(field);
          if (isTextArea) {
            // Check textarea fields
            const elem = document.querySelector(`textarea[name="${field}"]`);
            if (elem && elem.hasAttribute('required') && !elem.value.trim()) {
                const fieldLabel = field.replace(/_/g, ' ').toLowerCase();
                errors.push(`We'd appreciate your thoughts on ${fieldLabel}`);
            }        } else if (isInput || isHiddenInput) {
            // Check input fields (including hidden inputs)
            const elem = document.querySelector(`input[name="${field}"]`);
            if (elem && elem.hasAttribute('required') && !elem.value.trim()) {
                const fieldLabel = field.replace(/_/g, ' ').toLowerCase();
                errors.push(`Could you help us with ${fieldLabel}?`);
            }
            // For hidden inputs like registration_type, they should always have a value
            if (isHiddenInput && elem && !elem.value.trim()) {
                const fieldLabel = field.replace(/_/g, ' ').toLowerCase();
                errors.push(`Please let us know about ${fieldLabel}`);
            }        } else {
            // Check radio button fields
            const radioButtons = document.querySelectorAll(`input[name="${field}"]`);
            const selected = document.querySelector(`input[name="${field}"]:checked`);
            if (radioButtons.length > 0 && !selected) {
                const fieldLabel = field.replace(/_/g, ' ').toLowerCase();
                errors.push(`We'd love your feedback on ${fieldLabel}`);
            }
        }
    });    // Special validation for team size if team event
    {% if event.is_team_based %}
    const teamSizeInput = document.querySelector('input[name="team_size"]');
    if (teamSizeInput && teamSizeInput.value && (parseInt(teamSizeInput.value) < 1 || parseInt(teamSizeInput.value) > 20)) {
        errors.push('Team size should be between 1 and 20 members');
    }
    {% endif %}// Show errors if any
    if (errors.length > 0) {
        e.preventDefault();
        
        // Remove any existing error messages first
        document.querySelectorAll('.form-error').forEach(el => el.remove());
        
        // Create a more user-friendly error display
        const errorDiv = document.createElement('div');
        errorDiv.className = 'form-error fixed top-4 right-4 bg-red-50 border border-red-200 text-red-700 px-6 py-4 rounded-lg shadow-lg z-50 max-w-md';
        errorDiv.innerHTML = `
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                    </svg>
                </div>                <div class="ml-3">
                    <h3 class="text-sm font-medium">We'd love to hear more from you:</h3>
                    <ul class="mt-2 text-sm list-disc list-inside">
                        ${errors.map(error => `<li>${error}</li>`).join('')}
                    </ul>
                </div>
                <button type="button" onclick="this.parentElement.parentElement.remove()" class="ml-auto -mx-1.5 -my-1.5 text-red-400 hover:text-red-600">
                    <span class="sr-only">Dismiss</span>
                    <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                    </svg>
                </button>
            </div>
        `;
        
        document.body.appendChild(errorDiv);
        
        // Auto-remove after 8 seconds
        setTimeout(() => {
            if (errorDiv.parentElement) {
                errorDiv.remove();
            }
        }, 8000);
          // Scroll to first error field
        const firstErrorField = requiredFields.find(field => {
            const isTextArea = ['favorite_part', 'future_improvements', 'outstanding_sessions', 'future_suggestions', 'event_requests', 'additional_comments', 'payment_issues'].includes(field);
            const isInput = ['participant_name', 'participant_email', 'department', 'year_of_study', 'team_size'].includes(field);
            
            if (isTextArea || isInput) {
                const elem = document.querySelector(`input[name="${field}"], textarea[name="${field}"]`);
                return elem && !elem.value.trim() && elem.hasAttribute('required');
            } else {
                // Radio button field
                const selected = document.querySelector(`input[name="${field}"]:checked`);
                return !selected;
            }
        });
        
        if (firstErrorField) {
            const elem = document.querySelector(`input[name="${firstErrorField}"], textarea[name="${firstErrorField}"]`);
            if (elem) {
                // Find the step containing this field and navigate to it
                const stepElement = elem.closest('.form-step');
                if (stepElement) {
                    const stepNumber = parseInt(stepElement.getAttribute('data-step'));
                    if (stepNumber !== currentActualStep) {
                        showStep(stepNumber);
                    }
                }
                
                setTimeout(() => {
                    elem.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    if (elem.focus) elem.focus();
                }, 300);
            }
        }
        
        return false;
    }
    
    // Show success message before submission
    const submitBtn = e.target.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '‚è≥ Submitting Feedback...';
    submitBtn.disabled = true;
    
    // Re-enable if there are server errors (form will reload)
    setTimeout(() => {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    }, 10000);
});

// Add visual feedback for radio button selections
document.querySelectorAll('input[type="radio"]').forEach(radio => {
    radio.addEventListener('change', function() {
        // Remove previous selections styling in the same group
        document.querySelectorAll(`input[name="${this.name}"]`).forEach(r => {
            r.closest('label').classList.remove('bg-blue-50', 'border-blue-200');
        });
        
        // Add styling to selected option
        this.closest('label').classList.add('bg-blue-50', 'border-blue-200');
    });
});

// Add character counter for textareas
document.querySelectorAll('textarea').forEach(textarea => {
    // Get max length from the maxlength attribute or default to 500
    const maxLength = parseInt(textarea.getAttribute('maxlength')) || 500;
    
    const counter = document.createElement('div');
    counter.className = 'text-xs text-gray-500 mt-1 text-right';
    counter.textContent = `0/${maxLength} characters`;
    
    textarea.parentNode.appendChild(counter);
    
    textarea.addEventListener('input', function() {
        const length = this.value.length;
        counter.textContent = `${length}/${maxLength} characters`;
        
        if (length > maxLength * 0.9) {
            counter.className = 'text-xs text-orange-500 mt-1 text-right';
        } else {
            counter.className = 'text-xs text-gray-500 mt-1 text-right';
        }
        
        if (length > maxLength) {
            this.value = this.value.substring(0, maxLength);
            counter.textContent = `${maxLength}/${maxLength} characters (limit reached)`;
            counter.className = 'text-xs text-red-500 mt-1 text-right font-medium';
        }
    });
});
</script>
{% endblock %}
